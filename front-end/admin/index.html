<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey Mapper Admin - Links Module</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="admin-app">
        <header class="admin-header">
            <div class="admin-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128.5 42.6" style="height: 24px; width: auto;">
                    <path d="M5.9,42.6c-1.5,0-2.7-.3-3.6-.9-.9-.6-1.5-1.4-1.8-2.3s-.5-1.9-.5-3V9.1C0,6.2.7,3.9,2.2,2.5,3.7,1,5.9.3,9,.3s3.7.2,4.8.7c1.2.5,2.1,1.3,2.8,2.3.7,1.1,1.2,2.4,1.7,4.1l.3,1.2c.7,2.2,1.2,4,1.6,5.6.4,1.6.7,3,1,4.4.3,1.3.5,2.6.6,3.9.2,1.3.3,2.6.4,4.1.1-1.5.3-2.9.4-4.1s.4-2.6.6-3.9c.3-1.3.6-2.8,1-4.4.4-1.6,1-3.5,1.6-5.6l.3-1.2c.5-1.7,1.1-3,1.8-4.1.7-1.1,1.6-1.8,2.8-2.3,1.2-.5,2.8-.7,4.8-.7,3.1,0,5.4.7,6.8,2.2,1.4,1.5,2.2,3.7,2.2,6.6v27.2c0,1-.2,2-.5,3s-.9,1.7-1.8,2.3-2.1.9-3.6.9-2.7-.3-3.6-.9c-.9-.6-1.5-1.4-1.8-2.3s-.5-1.9-.5-3v-4.9c0-2.7.2-5.7.4-9,.2-3.3.4-7.2.5-11.5l-5.2,19.4c-.4,1.3-.8,2.4-1.3,3.2-.4.8-1,1.4-1.8,1.8-.7.4-1.8.6-3.2.6s-2.5-.2-3.2-.6c-.8-.4-1.4-1-1.8-1.8-.4-.8-.9-1.9-1.3-3.2l-5.2-19.4c.1,4.3.3,8.2.5,11.5s.3,6.4.4,9v4.9c0,1-.1,2-.4,3s-.9,1.7-1.8,2.3c-.9.6-2.1.9-3.6.9h0l.2.1Z" style="fill: var(--accent);"/>
                    <path d="M54.1,42.6c-.9,0-1.8-.2-2.8-.7s-1.7-1.2-2.4-2.1c-.6-.9-1-2-1-3.4s0-1.3.2-2.1c.1-.8.4-1.6.8-2.4l9.6-22.9c.6-1.5,1.2-2.9,1.7-4s1.1-2,1.7-2.8c.6-.7,1.4-1.3,2.4-1.6,1-.4,2.2-.5,3.8-.5s2.8.2,3.8.5c1,.4,1.8.9,2.4,1.6s1.2,1.7,1.7,2.8,1.1,2.4,1.7,4l9.6,22.9c.4.8.6,1.6.8,2.4.1.8.2,1.5.2,2.1,0,1.3-.3,2.5-1,3.4-.6.9-1.4,1.6-2.3,2.1s-1.9.7-2.8.7c-1.6,0-2.8-.3-3.7-1-.9-.7-1.6-1.6-2.1-2.7-.5-1.1-1-2.3-1.4-3.5l-1.3-4.2v-3.3c.1,0-3.8-10.1-3.8-10.1-.3-.8-.6-1.8-1-3s-.6-2.3-.9-3.2c-.2.9-.5,1.9-.9,3.2-.4,1.2-.7,2.2-1,3l-3.9,10.1v3.3c.1,0-1.2,4.2-1.2,4.2-.4,1.2-.8,2.4-1.3,3.5s-1.2,2-2.1,2.7-2.1,1-3.7,1h.2ZM59.2,33.1v-7.6h17.7v7.6h-17.7Z" style="fill: var(--text-primary);"/>
                    <path d="M97.8,42.6c-1.1,0-2.2-.3-3.2-.8s-1.9-1.3-2.5-2.3c-.7-1-1-2.2-1-3.7,0-1.9.5-3.5,1.6-4.7,1-1.2,2.4-2.5,4.1-3.9,1.2-.9,2.4-1.7,3.5-2.6,1.2-.9,2.3-1.8,3.5-2.7-.8-.7-1.9-1.6-3.2-2.7s-2.6-2.2-3.9-3.3c-1.7-1.4-3.1-2.8-4.1-4.1s-1.5-2.9-1.5-5c0-1.4.4-2.6,1-3.7.7-1,1.5-1.8,2.5-2.3,1-.5,2.1-.8,3.2-.8s2.5.3,3.4.8c.9.6,1.7,1.3,2.4,2.2s1.4,2,2,3.2c1,1.9,1.8,3.7,2.5,5.3s1.3,2.8,1.6,3.7c.3-.9.9-2.1,1.6-3.7.7-1.6,1.6-3.4,2.5-5.3.6-1.2,1.3-2.3,2-3.2.7-.9,1.5-1.7,2.4-2.2,1.1-.5,2.2-.8,3.5-.8s2.2.3,3.3.8c1,.5,1.9,1.3,2.5,2.4.7,1,1,2.2,1,3.7,0,2.1-.5,3.7-1.5,5-1,1.3-2.4,2.7-4.1,4.1-1.2,1-2.3,2-3.5,3s-2.3,2-3.5,2.9c.8.6,1.9,1.4,3.1,2.3,1.2,1,2.5,2,3.7,3,1.7,1.4,3.1,2.7,4.1,3.9,1,1.2,1.6,2.8,1.6,4.7s-.3,2.6-1,3.7c-.7,1-1.5,1.8-2.5,2.3s-2.1.8-3.3.8c-1.3,0-2.5-.3-3.4-.9-.9-.5-1.7-1.3-2.4-2.2-.7-1-1.4-2-2-3.2-.9-1.7-1.7-3.3-2.4-4.7-.8-1.4-1.3-2.7-1.7-3.7-.3,1-.9,2.3-1.7,3.7-.8,1.5-1.6,3-2.4,4.6-1,1.8-2,3.3-3.1,4.5s-2.7,1.8-4.7,1.8h0v.1Z" style="fill: var(--text-primary);"/>
                </svg>
                <div class="logo-text" style="margin-left: 12px; border-left: 1px solid var(--border-color); padding-left: 12px; height: 32px; display: flex; align-items: center;"><span>Admin</span></div>
            </div>
            <div class="admin-nav">
                <a href="#" class="active" id="nav-links">Links Module</a>
                <a href="#" id="nav-knowledge">Knowledge Base</a>
                <a href="#" id="nav-journeys">Journeys</a>
                <a href="#" id="nav-settings">Settings</a>
            </div>
        </header>

        <main class="admin-main-wrapper">
            <!-- Journeys Module -->
            <div class="admin-content" id="module-journeys" style="display: none;">
                <div class="module-header">
                    <div class="header-text">
                        <h1>Journeys</h1>
                        <p>View and manage captured journey maps.</p>
                    </div>
                    <div class="header-actions">
                        <div class="filter-controls">
                            <label><input type="radio" name="jFilter" value="all" checked> All</label>
                            <label><input type="radio" name="jFilter" value="complete"> Complete</label>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 24px; height: calc(100vh - 140px);">
                    <!-- Sidebar List -->
                    <div class="knowledge-sidebar" style="width: 300px; flex-shrink: 0; border-right: 1px solid var(--border-color); padding-right: 24px; overflow-y: auto;">
                        <div id="journeyList" class="saved-links-list">
                            <!-- Populated via JS -->
                        </div>
                    </div>

                    <!-- Main Content (Preview) -->
                    <div class="main-form" style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                        <div class="form-header" style="justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h2 id="journeyPreviewTitle" style="margin: 0;">Select a Journey</h2>
                            <div class="form-actions">
                                <a id="retakeBtn" href="#" target="_blank" class="primary-btn" style="display: none; text-decoration: none;">Retake / View Live</a>
                            </div>
                        </div>
                        
                        <div id="adminCanvasContainer" style="border: 1px solid var(--border-color); border-radius: 12px; flex: 1; overflow: hidden; background: var(--bg-secondary); position: relative;">
                            <div id="adminCanvas" class="journey-dashboard" style="height: 100%; overflow-y: auto; padding: 24px;">
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.5;">
                                    Select a journey to preview
                                </div>
                            </div>
                            
                            <!-- Hidden Modal for Admin Canvas -->
                            <div class="cell-detail-overlay" id="cellModal" onclick="closeCellModal(event)">
                                <div class="cell-detail-modal">
                                  <h3 id="modalTitle" style="font-size: 18px; margin-bottom: 12px; color: #fff;">Action</h3>
                                  <div id="modalContext" style="color: #ccc; line-height: 1.6;">Context</div>
                                  <button onclick="closeCellModal(null)" style="margin-top: 20px; padding: 8px 16px; background: #333; border: 1px solid #444; color: #fff; border-radius: 6px; cursor: pointer;">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <div class="sidebar-header">
                    <h2>Saved Configurations</h2>
                    <button id="newConfigBtn" class="icon-btn small" title="New Configuration">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
                <div id="savedLinksList" class="saved-links-list">
                    <!-- Links populated via JS -->
                    <div class="empty-state">No saved links yet.</div>
                </div>
            </aside>

            <!-- Main Editor -->
            <div class="admin-content" id="module-links">
                <!-- ... Links Content ... -->
                <div class="module-header">
                    <div class="header-text">
                        <h1>Link Generator</h1>
                        <p>Configure parameters to generate deep links for the Journey Mapper app.</p>
                    </div>
                    <div class="header-actions">
                         <div class="form-group compact" style="margin-bottom:0; min-width: 200px;">
                            <input type="text" id="configName" placeholder="Configuration Name (for saving)">
                        </div>
                        <button id="saveBtn" class="primary-btn">Save Configuration</button>
                        <button id="deleteBtn" class="secondary-btn danger-btn" style="display: none;">Delete</button>
                    </div>
                </div>

                <div class="config-grid">
                <!-- User Identity -->
                <div class="config-section">
                    <h2>User Identity</h2>
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" id="name" placeholder="e.g. Alice">
                        <div class="help-text">The user's first name.</div>
                    </div>
                    <div class="form-group">
                        <label for="role">Role</label>
                        <input type="text" id="role" placeholder="e.g. Product Manager">
                        <div class="help-text">The user's job title or role.</div>
                    </div>
                </div>

                <!-- Journey Context -->
                <div class="config-section">
                    <h2>Journey Context</h2>
                    <div class="form-group">
                        <label for="journey">Journey Name</label>
                        <input type="text" id="journey" placeholder="e.g. Onboarding Flow">
                        <div class="help-text">Pre-defines the journey name, skipping the inquiry.</div>
                    </div>
                </div>

                <!-- AI Behavior -->
                <div class="config-section">
                    <h2>AI Instructions</h2>
            <div class="form-group">
                <label>Knowledge Collections</label>
                <div id="knowledgeSelector" class="checkbox-group">
                    <!-- Populated via JS -->
                </div>
                <div class="help-text">Select one or more knowledge bases to inject into this session.</div>
            </div>
                    <div class="form-group">
                        <label for="welcome-prompt">Welcome Prompt Override</label>
                        <textarea id="welcome-prompt" rows="3" placeholder="e.g. Greet them like a pirate..."></textarea>
                        <div class="help-text">Custom instruction for the initial greeting (Step 1).</div>
                    </div>
                    <div class="form-group">
                        <label for="journey-prompt">Journey Prompt Override</label>
                        <textarea id="journey-prompt" rows="3" placeholder="e.g. Ask specifically about risk factors..."></textarea>
                        <div class="help-text">Custom instruction for inquiring about the journey (Step 3).</div>
                    </div>
                </div>

                <!-- Swimlanes Configuration -->
                <div class="config-section full-width">
                    <div class="section-header">
                        <h2>Swimlanes</h2>
                        <button type="button" id="addSwimlaneBtn" class="secondary-btn small-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Add Swimlane
                        </button>
                    </div>
                    <p class="section-desc">Pre-define swimlanes to skip the setup step.</p>
                    
                    <div id="swimlanesContainer" class="swimlanes-list">
                        <!-- Swimlane items added here -->
                    </div>
                </div>
            </div>

            <!-- Preview & Actions -->
            <div class="preview-bar">
                <div class="preview-content">
                    <label>Generated URL:</label>
                    <div class="url-display">
                        <code id="generatedUrl">http://localhost:3000/</code>
                        <button id="copyBtn" class="icon-btn" title="Copy to clipboard">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="preview-actions">
                    <a href="#" id="testLinkBtn" target="_blank" class="primary-btn">Test Link</a>
                </div>
            </div>
            </div> 

            <!-- Knowledge Module -->
            <div class="admin-content" id="module-knowledge" style="display: none;">
                <div class="module-header">
                    <div class="header-text">
                        <h1>Knowledge Base</h1>
                        <p>Manage context snippets injected into the AI sessions.</p>
                    </div>
                    <div class="header-actions">
                        <button id="newKnowledgeBtn" class="secondary-btn">New Entry</button>
                    </div>
                </div>

                <div style="display: flex; gap: 24px; height: calc(100vh - 140px);">
                    <!-- Knowledge List -->
                    <div class="knowledge-sidebar" style="width: 300px; flex-shrink: 0; border-right: 1px solid var(--border-color); padding-right: 24px; overflow-y: auto;">
                        <div id="knowledgeList" class="saved-links-list">
                            <!-- Populated via JS -->
                        </div>
                    </div>

                    <!-- Knowledge Editor -->
                    <div id="knowledgeForm" style="flex: 1; display: none;">
                        <div class="config-grid">
                            <div class="config-section full-width">
                                <div class="form-group">
                                    <label for="knowledgeTitle">Title</label>
                                    <input type="text" id="knowledgeTitle" placeholder="e.g. Vocabulary List">
                                </div>
                                <div class="form-group">
                                    <label for="knowledgeContent">Content (Context Snippet)</label>
                                    <textarea id="knowledgeContent" rows="15" placeholder="Enter the text to be injected into the AI's system prompt..."></textarea>
                                    <div class="help-text">This text will be appended to the system instructions when active.</div>
                                </div>
                                <div class="form-group checkbox-group">
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="knowledgeActive" checked>
                                        <span class="checkmark"></span>
                                        Active (Inject by default if no specific ID provided)
                                    </label>
                                </div>
                                <div class="form-actions" style="margin-top: 24px; display: flex; gap: 12px;">
                                    <button id="saveKnowledgeBtn" class="primary-btn">Create Knowledge Base</button>
                                    <button id="deleteKnowledgeBtn" class="secondary-btn danger-btn" style="display: none;">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Module -->
            <div class="admin-content" id="module-settings" style="display: none;">
                <div class="module-header">
                    <div class="header-text">
                        <h1>Settings</h1>
                        <p>Configure global application settings.</p>
                    </div>
                    <div class="header-actions">
                        <button id="saveSettingsBtn" class="primary-btn">Save Settings</button>
                    </div>
                </div>

                <div class="config-grid">
                    <div class="config-section full-width">
                        <h2>General</h2>
                        <div class="form-group">
                            <label for="agentName">Agent Name</label>
                            <input type="text" id="agentName" placeholder="Max" value="Max">
                            <div class="help-text">The name of the AI assistant displayed in the chat and used in system prompts.</div>
                        </div>
                        <div class="form-group">
                            <label for="activeModel">AI Model</label>
                            <select id="activeModel">
                                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite</option>
                            </select>
                            <div class="help-text">Select the Vertex AI model to power the assistant.</div>
                        </div>
                    </div>
                </div>
            </div>
        </main> <!-- Close admin-main-wrapper -->
    </div>

    <template id="swimlaneTemplate">
        <div class="swimlane-item">
            <div class="form-group compact">
                <input type="text" class="sw-name" placeholder="Name (e.g. Tools)">
            </div>
            <div class="form-group compact flex-grow">
                <input type="text" class="sw-desc" placeholder="Description (e.g. Software used)">
            </div>
            <button type="button" class="remove-btn" title="Remove">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
    </template>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="../js/renderer.js"></script>
    <script src="script.js"></script>
</body>
</html>